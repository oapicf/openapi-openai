#
# OpenAI API
# 
# The OpenAI REST API. Please see https://platform.openai.com/docs/api-reference for more details.
# The version of the OpenAPI document: 2.3.0
# Contact: blah+oapicf@cliffano.com
# Generated by: https://openapi-generator.tech
#

import json
import tables
import marshal
import options


type Endpoint* {.pure.} = enum
  V1ChatCompletions
  V1Embeddings
  V1Completions

type CompletionWindow* {.pure.} = enum
  `24h`

type CreateBatchRequest* = object
  ## 
  inputFileId*: string ## The ID of an uploaded file that contains requests for the new batch.  See [upload file](/docs/api-reference/files/create) for how to upload a file.  Your input file must be formatted as a [JSONL file](/docs/api-reference/batch/request-input), and must be uploaded with the purpose `batch`. The file can contain up to 50,000 requests, and can be up to 200 MB in size. 
  endpoint*: Endpoint ## The endpoint to be used for all requests in the batch. Currently `/v1/chat/completions`, `/v1/embeddings`, and `/v1/completions` are supported. Note that `/v1/embeddings` batches are also restricted to a maximum of 50,000 embedding inputs across all requests in the batch.
  completionWindow*: CompletionWindow ## The time frame within which the batch should be processed. Currently only `24h` is supported.
  metadata*: Option[Table[string, string]] ## Optional custom metadata for the batch.

func `%`*(v: Endpoint): JsonNode =
  result = case v:
    of Endpoint.V1ChatCompletions: %"/v1/chat/completions"
    of Endpoint.V1Embeddings: %"/v1/embeddings"
    of Endpoint.V1Completions: %"/v1/completions"
func `$`*(v: Endpoint): string =
  result = case v:
    of Endpoint.V1ChatCompletions: $("/v1/chat/completions")
    of Endpoint.V1Embeddings: $("/v1/embeddings")
    of Endpoint.V1Completions: $("/v1/completions")

proc to*(node: JsonNode, T: typedesc[Endpoint]): Endpoint =
  if node.kind != JString:
    raise newException(ValueError, "Expected string for enum Endpoint, got " & $node.kind)
  let strVal = node.getStr()
  case strVal:
  of $("/v1/chat/completions"):
    return Endpoint.V1ChatCompletions
  of $("/v1/embeddings"):
    return Endpoint.V1Embeddings
  of $("/v1/completions"):
    return Endpoint.V1Completions
  else:
    raise newException(ValueError, "Invalid enum value for Endpoint: " & strVal)

func `%`*(v: CompletionWindow): JsonNode =
  result = case v:
    of CompletionWindow.`24h`: %"24h"
func `$`*(v: CompletionWindow): string =
  result = case v:
    of CompletionWindow.`24h`: $("24h")

proc to*(node: JsonNode, T: typedesc[CompletionWindow]): CompletionWindow =
  if node.kind != JString:
    raise newException(ValueError, "Expected string for enum CompletionWindow, got " & $node.kind)
  let strVal = node.getStr()
  case strVal:
  of $("24h"):
    return CompletionWindow.`24h`
  else:
    raise newException(ValueError, "Invalid enum value for CompletionWindow: " & strVal)


# Custom JSON deserialization for CreateBatchRequest with custom field names
proc to*(node: JsonNode, T: typedesc[CreateBatchRequest]): CreateBatchRequest =
  result = CreateBatchRequest()
  if node.kind == JObject:
    if node.hasKey("input_file_id"):
      result.inputFileId = to(node["input_file_id"], string)
    if node.hasKey("endpoint"):
      result.endpoint = to(node["endpoint"], Endpoint)
    if node.hasKey("completion_window"):
      result.completionWindow = to(node["completion_window"], CompletionWindow)
    if node.hasKey("metadata") and node["metadata"].kind != JNull:
      result.metadata = some(to(node["metadata"], typeof(result.metadata.get())))

# Custom JSON serialization for CreateBatchRequest with custom field names
proc `%`*(obj: CreateBatchRequest): JsonNode =
  result = newJObject()
  result["input_file_id"] = %obj.inputFileId
  result["endpoint"] = %obj.endpoint
  result["completion_window"] = %obj.completionWindow
  if obj.metadata.isSome():
    result["metadata"] = %obj.metadata.get()

