#
# OpenAI API
# 
# The OpenAI REST API. Please see https://platform.openai.com/docs/api-reference for more details.
# The version of the OpenAPI document: 2.3.0
# Contact: blah+oapicf@cliffano.com
# Generated by: https://openapi-generator.tech
#

import json
import tables
import marshal
import options

import model_object
import model_realtime_conversation_item
import model_realtime_response_status_details
import model_realtime_response_usage

type `Object`* {.pure.} = enum
  RealtimeResponse

type Status* {.pure.} = enum
  Completed
  Cancelled
  Failed
  Incomplete

type RealtimeResponse* = object
  ## The response resource.
  id*: Option[string] ## The unique ID of the response.
  `object`*: Option[`Object`] ## The object type, must be `realtime.response`.
  status*: Option[Status] ## The final status of the response (`completed`, `cancelled`, `failed`, or  `incomplete`). 
  statusDetails*: Option[RealtimeResponse_status_details]
  output*: Option[seq[RealtimeConversationItem]] ## The list of output items generated by the response.
  metadata*: Option[JsonNode] ## Developer-provided string key-value pairs associated with this response. 
  usage*: Option[RealtimeResponse_usage]

func `%`*(v: `Object`): JsonNode =
  result = case v:
    of `Object`.RealtimeResponse: %"realtime.response"
func `$`*(v: `Object`): string =
  result = case v:
    of `Object`.RealtimeResponse: $("realtime.response")

proc to*(node: JsonNode, T: typedesc[`Object`]): `Object` =
  if node.kind != JString:
    raise newException(ValueError, "Expected string for enum `Object`, got " & $node.kind)
  let strVal = node.getStr()
  case strVal:
  of $("realtime.response"):
    return `Object`.RealtimeResponse
  else:
    raise newException(ValueError, "Invalid enum value for `Object`: " & strVal)

func `%`*(v: Status): JsonNode =
  result = case v:
    of Status.Completed: %"completed"
    of Status.Cancelled: %"cancelled"
    of Status.Failed: %"failed"
    of Status.Incomplete: %"incomplete"
func `$`*(v: Status): string =
  result = case v:
    of Status.Completed: $("completed")
    of Status.Cancelled: $("cancelled")
    of Status.Failed: $("failed")
    of Status.Incomplete: $("incomplete")

proc to*(node: JsonNode, T: typedesc[Status]): Status =
  if node.kind != JString:
    raise newException(ValueError, "Expected string for enum Status, got " & $node.kind)
  let strVal = node.getStr()
  case strVal:
  of $("completed"):
    return Status.Completed
  of $("cancelled"):
    return Status.Cancelled
  of $("failed"):
    return Status.Failed
  of $("incomplete"):
    return Status.Incomplete
  else:
    raise newException(ValueError, "Invalid enum value for Status: " & strVal)


# Custom JSON deserialization for RealtimeResponse with custom field names
proc to*(node: JsonNode, T: typedesc[RealtimeResponse]): RealtimeResponse =
  result = RealtimeResponse()
  if node.kind == JObject:
    if node.hasKey("id") and node["id"].kind != JNull:
      result.id = some(to(node["id"], typeof(result.id.get())))
    if node.hasKey("object") and node["object"].kind != JNull:
      result.`object` = some(to(node["object"], `Object`))
    if node.hasKey("status") and node["status"].kind != JNull:
      result.status = some(to(node["status"], Status))
    if node.hasKey("status_details") and node["status_details"].kind != JNull:
      result.statusDetails = some(to(node["status_details"], typeof(result.statusDetails.get())))
    if node.hasKey("output") and node["output"].kind != JNull:
      # Optional array of types with custom JSON - manually iterate and deserialize
      let arrayNode = node["output"]
      if arrayNode.kind == JArray:
        var arr: seq[RealtimeConversationItem] = @[]
        for item in arrayNode.items:
          arr.add(to(item, RealtimeConversationItem))
        result.output = some(arr)
    if node.hasKey("metadata") and node["metadata"].kind != JNull:
      result.metadata = some(to(node["metadata"], typeof(result.metadata.get())))
    if node.hasKey("usage") and node["usage"].kind != JNull:
      result.usage = some(to(node["usage"], typeof(result.usage.get())))

# Custom JSON serialization for RealtimeResponse with custom field names
proc `%`*(obj: RealtimeResponse): JsonNode =
  result = newJObject()
  if obj.id.isSome():
    result["id"] = %obj.id.get()
  if obj.`object`.isSome():
    result["object"] = %obj.`object`.get()
  if obj.status.isSome():
    result["status"] = %obj.status.get()
  if obj.statusDetails.isSome():
    result["status_details"] = %obj.statusDetails.get()
  if obj.output.isSome():
    result["output"] = %obj.output.get()
  if obj.metadata.isSome():
    result["metadata"] = %obj.metadata.get()
  if obj.usage.isSome():
    result["usage"] = %obj.usage.get()

